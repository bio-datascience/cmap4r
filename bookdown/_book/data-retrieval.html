<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title></title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="catalog-of-data.html">
<link rel="next" href="visualization.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About the ‘cmap4r’ R package</a></li>
<li class="chapter" data-level="1" data-path="catalog-of-data.html"><a href="catalog-of-data.html"><i class="fa fa-check"></i><b>1</b> Catalog of data</a></li>
<li class="chapter" data-level="2" data-path="data-retrieval.html"><a href="data-retrieval.html"><i class="fa fa-check"></i><b>2</b> Data Retrieval</a><ul>
<li class="chapter" data-level="2.1" data-path="data-retrieval.html"><a href="data-retrieval.html#getting-started-simpler-functions"><i class="fa fa-check"></i><b>2.1</b> Getting started &amp; simpler functions</a></li>
<li class="chapter" data-level="2.2" data-path="data-retrieval.html"><a href="data-retrieval.html#download-data"><i class="fa fa-check"></i><b>2.2</b> Download data</a></li>
<li class="chapter" data-level="2.3" data-path="data-retrieval.html"><a href="data-retrieval.html#summarize-data"><i class="fa fa-check"></i><b>2.3</b> Summarize data</a></li>
<li class="chapter" data-level="2.4" data-path="data-retrieval.html"><a href="data-retrieval.html#colocalize-data"><i class="fa fa-check"></i><b>2.4</b> Colocalize data</a></li>
<li class="chapter" data-level="2.5" data-path="data-retrieval.html"><a href="data-retrieval.html#issue-sql-query"><i class="fa fa-check"></i><b>2.5</b> Issue SQL query</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>3</b> Visualization</a><ul>
<li class="chapter" data-level="3.1" data-path="visualization.html"><a href="visualization.html#scatterplot-of-two-variables"><i class="fa fa-check"></i><b>3.1</b> Scatterplot of two variables</a></li>
<li class="chapter" data-level="3.2" data-path="visualization.html"><a href="visualization.html#histograms"><i class="fa fa-check"></i><b>3.2</b> Histograms</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>4</b> FAQ</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-retrieval" class="section level1">
<h1><span class="header-section-number">2</span> Data Retrieval</h1>
<div id="getting-started-simpler-functions" class="section level2">
<h2><span class="header-section-number">2.1</span> Getting started &amp; simpler functions</h2>
<p>Data in the CMAP database exists in tables, and can be accessed by specific table names, and variable names therein. For instance, sea surface temperature is from the table <code>&quot;tblSST_AVHRR_OI_NRT&quot;</code>, and the variable name is <code>&quot;sst&quot;</code>. The full set of table names and variable names can be found here:</p>
<p><a href="https://cmap.readthedocs.io/en/latest/catalog/catalog.html" class="uri">https://cmap.readthedocs.io/en/latest/catalog/catalog.html</a></p>
<p>The CMAP4R function <code>get_catalog()</code> retrieves the latest version. Examples of simpler functions are here:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load_all</span>(<span class="st">&quot;~/repos/cmap4r/cmap4r&quot;</span>)

## Simpler functions ####################
cruisename =<span class="st"> &quot;KOK1606&quot;</span>
<span class="kw">head</span>(<span class="st">&#39;tblFalkor_2018&#39;</span>)
<span class="kw">columns</span>(<span class="st">&#39;tblAMT13_Chisholm&#39;</span>)
<span class="kw">cruise_by_name</span>(cruisename)
<span class="kw">cruise_bounds</span>(cruisename)
<span class="kw">print</span>(<span class="kw">get_catalog</span>())</code></pre></div>
<p>Each table contains many data “rows”, which are indexed by “keys” of the four values:</p>
<p><strong>(Time, Latitude, Longitude, Depth)</strong></p>
<p>Most functions in this package will involve using these data key values, or user-specified ranges of these keys, for certain operations. The most basic operation, explained next, is to download a dataset from a time and space range of interest.</p>
</div>
<div id="download-data" class="section level2">
<h2><span class="header-section-number">2.2</span> Download data</h2>
<p>When retrieving all data from <strong>CMAP</strong> in a “rectangle” of space and time, specifies the following:</p>
<ul>
<li>Name of table (<code>table</code>)</li>
<li>Names of variables in that table (<code>variable</code>)</li>
<li>Upper and lower limits of the variables (<code>dt1</code>, <code>dt2</code>, <code>lon1</code>, <code>lon2</code>, <code>lat1</code>, <code>lat2</code>, <code>depth1</code>, <code>depth2</code>)</li>
</ul>
<p>These are used in the <code>space_time()</code> function, which downloads the data as a data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat =<span class="st"> </span><span class="kw">space_time</span>(<span class="dt">table =</span> <span class="st">&#39;tblsst_AVHRR_OI_NRT&#39;</span>,
                 <span class="dt">variable =</span> <span class="st">&#39;sst&#39;</span>,
                 <span class="dt">dt1 =</span> <span class="st">&#39;2016-04-30&#39;</span>,
                 <span class="dt">dt2 =</span> <span class="st">&#39;2016-04-30&#39;</span>,
                 <span class="dt">lon1 =</span> <span class="dv">69</span>,
                 <span class="dt">lon2 =</span> <span class="dv">70</span>,
                 <span class="dt">lat1 =</span> <span class="dv">-161</span>,
                 <span class="dt">lat2 =</span> <span class="dv">-160</span>,
                 <span class="dt">depth1 =</span> <span class="dv">0</span>,
                 <span class="dt">depth2 =</span> <span class="dv">5</span>)</code></pre></div>
</div>
<div id="summarize-data" class="section level2">
<h2><span class="header-section-number">2.3</span> Summarize data</h2>
<p><strong>Code is outdated</strong></p>
<p>A typical table’s “attributes” include:</p>
<ul>
<li>Name of variables,</li>
<li>Type of variables, i.e., quantitative, qualitative, time,</li>
<li>Size of the table,</li>
<li>Space-time range information,</li>
<li>Numerical variable range summary.</li>
</ul>
<p>These are used in the various following functions, which are designed to summarize data tables by extracting these table attributes. This is useful for learning about the tables without downloading them prior to analysis. Here are some key examples:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(odbc<span class="op">::</span><span class="kw">odbc</span>(), <span class="dt">DSN=</span><span class="st">&quot;CMAP-MSSQL&quot;</span>,<span class="dt">UID=</span><span class="st">&quot;ArmLab&quot;</span>,<span class="dt">PWD=</span><span class="st">&quot;ArmLab2018&quot;</span>)
DBI<span class="op">::</span><span class="kw">dbExecute</span>(con, <span class="st">&quot;SET QUOTED_IDENTIFIER ON&quot;</span>)

## Choose a table:
table_name &lt;-<span class="st">  &quot;tblsst_AVHRR_OI_NRT&quot;</span>
table_name &lt;-<span class="st"> &quot;tblModis_AOD_REP&quot;</span>
exclude_tablenames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;tblModis_AOD_REP&quot;</span>,
                        <span class="st">&quot;tblHOT_Macrozooplankton&quot;</span>,
                        <span class="st">&quot;tblDarwin_3day&quot;</span>)
table_name =<span class="st"> </span>exclude_tablenames[<span class="dv">2</span>]

table_name =<span class="st"> &quot;tblDarwin_Nutrient_Climatology&quot;</span>

<span class="co"># Variable name in the table</span>
tbl_fields &lt;-<span class="st"> </span><span class="kw">dbListFields</span>(con, table_name)
<span class="kw">print</span>(tbl_fields)

## Obtain a sample of the data 
tbl_fields &lt;-<span class="st"> </span><span class="kw">tbl_sample</span>(con, table_name, <span class="dt">n=</span><span class="dv">5</span>)
<span class="kw">print</span>(tbl_fields)

<span class="co"># See the data type of each column in the table</span>
tbl_colClass =<span class="st"> </span><span class="kw">tbl_vartype</span>(con, table_name)
<span class="kw">print</span>(tbl_colClass)

<span class="co"># Number of observations</span>
nObs =<span class="st"> </span><span class="kw">tbl_nobs</span>(con, table_name)
<span class="kw">print</span>(nObs)

<span class="co"># Space/time range of the table (slow if table is big)</span>
tbl_spacetime =<span class="st"> </span><span class="kw">tbl_spacetime_range</span>(con, table_name)
<span class="kw">print</span>(tbl_spacetime)

<span class="co"># Range of only the numeric variables:</span>
tbl_range &lt;-<span class="st"> </span><span class="kw">tbl_numvar_range</span>(con,table_name)
<span class="kw">print</span>(tbl_range)

<span class="kw">dbDisconnect</span>(con)</code></pre></div>
</div>
<div id="colocalize-data" class="section level2">
<h2><span class="header-section-number">2.4</span> Colocalize data</h2>
<p>First of all, what does it mean to <em>colocalize</em>? Imagine a ship moving along a trajectory, whose location in space and time is recorded in latitude/longitude/time. Then, we’d like to obtain data like sea surface temperature or salinity, <em>as if we were recording it along the ship’s trajectory</em>. Colocalization simply means retrieving such data manually from the database, by querying from the <em>vicinity</em> (a rectangle) of each lat/lon/time triplet of interest, and summarizing it (e.g. taking the average).</p>
<p>The size of the vicinity is define by the user-specified “slack” in longitude, latitude and time. For instance, one could ask for 1 degrees of slack in longitude and latitude, and 6 hours of slack in time.</p>
<p>The main function is <code>along_track</code>, which colocalizes data for one or multiple tables and variables at a time. The available cruises can be found by running the function <code>cruises()</code>. The available data tables and variable names are listed in the catalog (<code>get_catalog()</code>, or from <a href="https://cmap.readthedocs.io/en/latest/catalog/catalog.html" class="uri">https://cmap.readthedocs.io/en/latest/catalog/catalog.html</a>). Here is a short example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Colocalize a cruise that are already in CMAP:
cruise=<span class="st">&#39;diel&#39;</span>
targetTables=<span class="kw">c</span>(<span class="st">&#39;tblSeaFlow&#39;</span>, <span class="st">&#39;tblPisces_NRT&#39;</span>)
targetVars=<span class="kw">c</span>(<span class="st">&#39;synecho_abundance&#39;</span>, <span class="st">&#39;NO3&#39;</span>)
depth1=<span class="dv">0</span>
depth2=<span class="dv">5</span>
temporalTolerance=<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)
latTolerance=<span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>)
lonTolerance=<span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>)
depthTolerance=<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">5</span>)
<span class="kw">la</span>(<span class="st">&quot;~/repos/cmap4r/package/cmap4r&quot;</span>)
dat =<span class="st"> </span><span class="kw">along_track</span>(cruise[<span class="dv">1</span>],
                  targetTables[<span class="dv">1</span>],
                  targetVars[<span class="dv">1</span>],
                  depth1[<span class="dv">1</span>],
                  depth2[<span class="dv">1</span>],
                  temporalTolerance[<span class="dv">1</span>],
                  latTolerance[<span class="dv">1</span>],
                  lonTolerance[<span class="dv">1</span>],
                  depthTolerance[<span class="dv">1</span>])</code></pre></div>
</div>
<div id="issue-sql-query" class="section level2">
<h2><span class="header-section-number">2.5</span> Issue SQL query</h2>
<p>(For advanced users) Simons CMAP datasets are hosted in a SQL database and the CMAP4R R package provides the user with a number of pre-developed methods to extract and retrieve subsets of the data. The rest of this documentation is dedicated to explore and explain these methods. In addition to the pre-developed functions described above, you may issue custom SQL query statement and returns the results in form of a data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">apiKey =<span class="st"> &quot;5e05c500-d68d-11e9-9d3b-4f83fcec4710&quot;</span> ## <span class="al">TODO</span>: erase
<span class="kw">query</span>(<span class="st">&quot;SELECT [time], lat, lon, depth, Fe FROM tblPisces_NRT</span>
<span class="st">         WHERE</span>
<span class="st">         [time] BETWEEN &#39;2017-06-03&#39; AND &#39;2017-06-03&#39; AND</span>
<span class="st">         lat BETWEEN 10 AND 55 AND</span>
<span class="st">         lon BETWEEN -180 AND 100 AND</span>
<span class="st">         depth BETWEEN 0 AND 0.5</span>
<span class="st">         ORDER BY [time], lat, lon, depth&quot;</span>, apiKey)</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="catalog-of-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
