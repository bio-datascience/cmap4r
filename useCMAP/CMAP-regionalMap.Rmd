---
title: <center> <h1> Regional map </h1> </center> 
# author: Aditya Kumar Mishra
output: html_document
# output: github_document
---

```{r setup, include=FALSE}
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE,fig.width=10, fig.height=8,
                      fig.align = "center",
                      out.width = "100%")
rm(list = ls())
library(cmap4r)
library(DBI)
```



We plot a variable of interest from **CMAP** in a range of latitude and longitude at a given point of time.

Specify following parameters to retrieve required data from **CMAP**. 

+ Table Name (table.name)
+ Variables to be extracted (sel.var)
+ Range variable includes (latitude, longitude, depth, time)


**plot_regMap** function download the data, and output a list which contain a) regional map plot object: **plot_ly/ggplot** with "x axis" as "longitude" and "y axis" as "lattitude"; b) corresponding data table. 




## Example I

```{r message=FALSE, warning=FALSE, echo=TRUE}
con <- dbConnect(odbc::odbc(), DSN="CMAP-MSSQL",UID="ArmLab",PWD="ArmLab2018")

# Inpit variable:
table.name = 'tblsst_AVHRR_OI_NRT'   
sel.var = 'sst'                 
range.var <- list()
range.var$lat <- c(10,70)
range.var$lon <- c(-180,-80)
range.var$time <- c('2016-04-30', '2016-04-30')


## Data retrieval
tbl.subset <- getTableData(con, table.name, sel.var, range.var, order.var=  c('lat','lon'))
head(tbl.subset)


## Plot - regional map 
# out <- plot_regMap(con, table.name,sel.var,range.var, type = 'ggplot')
out <- plot_regMap(con, table.name,sel.var,range.var, type = 'plotly')
out$plot

dbDisconnect(con)
```



## Example II

```{r message=FALSE, warning=FALSE, echo=TRUE}
con <- dbConnect(odbc::odbc(), DSN="CMAP-MSSQL",UID="ArmLab",PWD="ArmLab2018")



table.name <- "tblPisces_NRT"   
sel.var <-  "Fe"               
range.var <- list()
range.var$lat <- c(10,70)
range.var$lon <- c(-180,-80)
range.var$depth <- c(0,0.5)
range.var$time <- c('2016-04-30', '2016-04-30')


## Subset selection:
tbl.subset <- getTableData(con, table.name, sel.var, range.var, order.var=  c('lat','lon'))
head(tbl.subset)


## Plot - regional map 
# out <- plot_regMap(con, table.name,sel.var,range.var, type = 'ggplot')
out <- plot_regMap(con, table.name,sel.var,range.var, type = 'plotly')
out$plot

dbDisconnect(con)
```


