---
title: <center> <h1> XY Plot </h1> </center>  
# author: Aditya Kumar Mishra
output: html_document
# output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,fig.width=15, fig.height=7,fig.align = "center",
                      out.width = "100%")
rm(list = ls())
library(cmap4r)
library(DBI)
```



Use scatter plot to compare two variable of interest from **CMAP**.  


Specify following parameters to retrieve required data.

+ Table Name (table.name)
+ Variables to be extracted (sel.var)
+ Range variable includes (latitude, longitude, depth, time)


In addition to this, specify “agg.var” parameter to aggregate the variable of interest, and align the data from the two tables. For example, we select agg.var = "time". 

<!-- In addition to this, specify aggregate variable. For example, we select agg.var = "time". We use this variable to allign the data from the two table downloaded from the CMAP.  -->


**plot_xy** function download the data, and output a list which contain a) plot object: **plot_ly/ggplot**; b) corresponding data tables. 




```{r message=FALSE, warning=FALSE, echo=TRUE}
con <- dbConnect(odbc::odbc(), DSN="CMAP-MSSQL",UID="ArmLab",PWD="ArmLab2018")
# Inpit variable:
# 
table.list <- c('tblSST_AVHRR_OI_NRT', 'tblAltimetry_REP') 
var.list <-  c('sst', 'sla')  
#
range.var <- list()
range.var$lat <- c(25,30)
range.var$lon <- c(-160, -155)
range.var$time <- c('2016-03-29', '2016-05-29')
#
agg.var <- 'time' 

## -----------------------------------
## Dataset from table II
selIndex <- 1
table.name <- table.list[selIndex]                       # Specify table name I
sel.var <- var.list[selIndex]                            # Variable from table name I  

tbl.subset.x <- getAggregatedTableData(con, table.name, sel.var, range.var, agg.var)
head(tbl.subset.x)


## Dataset from table II
selIndex <- 2
table.name <- table.list[selIndex]                       # Specify table name II
sel.var <- var.list[selIndex]                            # Variable from table name II


tbl.subset.y <- getAggregatedTableData(con, table.name, sel.var, range.var, agg.var)
head(tbl.subset.y)



## Plot - XY
# out <- plot_xy(con, table.list,var.list,range.var,agg.var,type = 'ggplot')
out <- plot_xy(con, table.list,var.list,range.var,agg.var,type = 'plotly')
out$plot
dbDisconnect(con)
```






